<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto News Queue</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        textarea { width: 100%; height: 80px; margin: 5px 0; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .save { background: #4CAF50; color: white; }
        .approve { background: #2196F3; color: white; }
        .decline { background: #f44336; color: white; }
        .copy { background: #ff9800; color: white; }
        img { max-width: 100%; height: auto; }
    </style>
</head>
<body>
    <h1>üì∞ Crypto News Queue</h1>
    <div id="news-list"></div>

    <script>
        // ===== C·∫§U H√åNH =====
        const GITHUB_USER = 'TEN_GITHUB_CUA_BAN';  // Thay ƒë·ªïi
        const GITHUB_REPO = 'crypto-news-queue';   // Thay ƒë·ªïi n·∫øu c·∫ßn
        const N8N_WEBHOOK_BASE = 'https://N8N_URL_CUA_BAN/webhook';  // Thay ƒë·ªïi
        
        const QUEUE_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/data/queue.json`;
        const WEBHOOKS = {
            save: `${N8N_WEBHOOK_BASE}/save`,
            approve: `${N8N_WEBHOOK_BASE}/approve`,
            decline: `${N8N_WEBHOOK_BASE}/decline`
        };

        let newsData = [];

        // Load d·ªØ li·ªáu t·ª´ GitHub
        async function loadNews() {
            try {
                const response = await fetch(QUEUE_URL + '?t=' + Date.now());
                newsData = await response.json();
                displayNews();
            } catch (error) {
                console.error('L·ªói load d·ªØ li·ªáu:', error);
                document.getElementById('news-list').innerHTML = '<p>Kh√¥ng th·ªÉ load d·ªØ li·ªáu</p>';
            }
        }

        // Hi·ªÉn th·ªã danh s√°ch tin t·ª©c
        function displayNews() {
            const container = document.getElementById('news-list');
            const pendingNews = newsData.filter(item => item.status === 'pending' || item.status === 'saved');
            
            if (pendingNews.length === 0) {
                container.innerHTML = '<p>Kh√¥ng c√≥ tin t·ª©c n√†o ƒëang ch·ªù duy·ªát</p>';
                return;
            }

            container.innerHTML = pendingNews.map(item => `
                <div class="card">
                    <h3>${item.title || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ'}</h3>
                    <p><strong>Ngu·ªìn:</strong> ${item.source || 'Unknown'}</p>
                    <p><strong>Link:</strong> <a href="${item.link}" target="_blank">M·ªü b√†i vi·∫øt</a></p>
                    
                    ${item.image_url ? `
                        <img src="${item.image_url}" alt="·∫¢nh b√†i vi·∫øt">
                        <button class="copy" onclick="copyToClipboard('${item.image_url}')">Copy ·∫£nh URL</button>
                    ` : ''}
                    
                    <div>
                        <label>B√†i vi·∫øt cho X (Twitter):</label>
                        <textarea id="x-${item.id}" placeholder="N·ªôi dung cho X...">${item.x_text || ''}</textarea>
                        <button class="copy" onclick="copyToClipboard(document.getElementById('x-${item.id}').value)">Copy X</button>
                    </div>
                    
                    <div>
                        <label>B√†i vi·∫øt cho CMC:</label>
                        <textarea id="cmc-${item.id}" placeholder="N·ªôi dung cho CMC...">${item.cmc_text || ''}</textarea>
                        <button class="copy" onclick="copyToClipboard(document.getElementById('cmc-${item.id}').value)">Copy CMC</button>
                    </div>
                    
                    ${!item.image_url ? `
                        <div>
                            <label>Prompt t·∫°o ·∫£nh:</label>
                            <textarea id="prompt-${item.id}" placeholder="M√¥ t·∫£ ·∫£nh c·∫ßn t·∫°o...">${item.image_prompt || ''}</textarea>
                            <button class="copy" onclick="copyToClipboard(document.getElementById('prompt-${item.id}').value)">Copy Prompt</button>
                        </div>
                    ` : ''}
                    
                    <div>
                        <button class="save" onclick="saveItem('${item.id}')">üíæ Save</button>
                        <button class="approve" onclick="approveItem('${item.id}')">‚úÖ Approve & Post X</button>
                        <button class="decline" onclick="declineItem('${item.id}')">‚ùå Decline</button>
                    </div>
                </div>
            `).join('');
        }

        // Copy text to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('ƒê√£ copy!');
            });
        }

        // G·ª≠i webhook
        async function sendWebhook(type, itemId) {
            const item = newsData.find(i => i.id === itemId);
            if (!item) return;

            const payload = {
                id: itemId,
                x_text: document.getElementById(`x-${itemId}`)?.value || item.x_text,
                cmc_text: document.getElementById(`cmc-${itemId}`)?.value || item.cmc_text,
                image_prompt: document.getElementById(`prompt-${itemId}`)?.value || item.image_prompt
            };

            try {
                const response = await fetch(WEBHOOKS[type], {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alert(`${type.toUpperCase()} th√†nh c√¥ng!`);
                    loadNews(); // Reload d·ªØ li·ªáu
                } else {
                    alert(`L·ªói ${type}: ${response.status}`);
                }
            } catch (error) {
                alert(`L·ªói k·∫øt n·ªëi: ${error.message}`);
            }
        }

        // C√°c h√†m x·ª≠ l√Ω
        function saveItem(id) { sendWebhook('save', id); }
        function approveItem(id) { sendWebhook('approve', id); }
        function declineItem(id) { sendWebhook('decline', id); }

        // Load d·ªØ li·ªáu khi trang load
        loadNews();
    </script>
</body>
</html>
